function displayMembersInformation(ns, memberName) {
    const memberInfo = ns.gang.getMemberInformation(memberName);
    const hackingLevel = memberInfo['hack'];
    const currentTask = memberInfo['task'];
    ns.print(`Member: ${memberName}\thacking level: ${hackingLevel}\ttask: ${currentTask}`);
}
function assignMember(ns, name, task = '') {
    const memberInfo = ns.gang.getMemberInformation(name);
    const hackingLevel = memberInfo['hack'];
    const currentTask = memberInfo['task'];
    /*
    Task names:
        - Unassigned
        - Ransomware
        - Phishing
        - Identity Theft
        - DDoS Attacks
        - Plant Virus
        - Fraud & Counterfeiting,
        - Money Laundering
        - Cyberterrorism
        - Ethical Hacking
        - Vigilante Justice
        - Train Combat
        - Train Hacking
        - Train Charisma
        - Territory Warfare
    */
    if (task != '') {
        if (currentTask != task) {
            ns.gang.setMemberTask(name, task);
        }
    }
    else if (hackingLevel < 120) {
        if (currentTask != 'Cyberterrorism') {
            ns.gang.setMemberTask(name, 'Cyberterrorism');
        }
    }
    else {
        if (currentTask != 'Money Laundering') {
            ns.gang.setMemberTask(name, 'Money Laundering');
        }
    }
}
function recruitIfPossible(ns) {
    if (!ns.gang.canRecruitMember()) {
        return;
    }
    const gangMembers = ns.gang.getMemberNames();
    const newGangMemberName = `audrey-${gangMembers.length + 1}`;
    ns.gang.recruitMember(newGangMemberName);
    assignMember(ns, newGangMemberName);
}
function reassignMembersAccordingToWantedLevelPenalty(ns) {
    const gangInformation = ns.gang.getGangInformation();
    /*
    Gang information structure:
    {
        "faction":"NiteSec",
        "isHacking":true,
        "moneyGainRate":213.18959642323077,
        "power":1,
        "respect":846.631799960249,
        "respectGainRate":0,
        "territory":0.14285714285714293,
        "territoryClashChance":0,
        "territoryWarfareEngaged":false,
        "wantedLevel":310.2473419438491,
        "wantedLevelGainRate":-0.025302857142857158,
        "wantedPenalty":0.7318238952487159
    }
    */
    const wantedLevelPenalty = 1.0 - gangInformation['wantedPenalty'];
    const gangRespect = gangInformation['respect'];
    if (wantedLevelPenalty > 0.25 && gangRespect > 50) {
        ns.gang.getMemberNames().map(memberName => {
            assignMember(ns, memberName, 'Ethical Hacking');
        });
    }
    else {
        ns.gang.getMemberNames().map(memberName => {
            assignMember(ns, memberName);
        });
    }
}
function ascendIfGainIsWorth(ns) {
    ns.gang.getMemberNames().map(memberName => {
        const results = ns.gang.getAscensionResult(memberName);
        if (results === undefined) {
            return;
        }
        const hackingMultWithAscension = results['hack'];
        if (hackingMultWithAscension > 2.0) {
            ns.gang.ascendMember(memberName);
            assignMember(ns, memberName);
        }
    });
}
function buyEquipment(ns) {
    /*
        [
            "Baseball Bat",
            "Katana",
            "Glock 18C",
            "P90C",
            "Steyr AUG",
            "AK-47",
            "M15A10 Assault Rifle",
            "AWM Sniper Rifle",
            "Bulletproof Vest",
            "Full Body Armor",
            "Liquid Body Armor",
            "Graphene Plating Armor",
            "Ford Flex V20",
            "ATX1070 Superbike",
            "Mercedes-Benz S9001",
            "White Ferrari",
            "NUKE Rootkit",
            "Soulstealer Rootkit",
            "Demon Rootkit",
            "Hmap Node",
            "Jack the Ripper",
            "Bionic Arms",
            "Bionic Legs",
            "Bionic Spine",
            "BrachiBlades",
            "Nanofiber Weave",
            "Synthetic Heart",
            "Synfibril Muscle",
            "BitWire",
            "Neuralstimulator",
            "DataJack",
            "Graphene Bone Lacings"
            ]
    */
    const hackingUpgrades = ['NUKE Rootkit', 'Soulstealer Rootkit', 'Demon Rootkit', 'Hmap Node', 'Jack the Ripper'];
    const hackingAugmentations = ['BitWire', 'Neuralstimulator', 'DataJack'];
    ns.gang.getMemberNames().map(memberName => {
        const memberInfo = ns.gang.getMemberInformation(memberName);
        const memberHackingUpgrade = memberInfo['upgrades'];
        const memberHackingAugmentations = memberInfo['augmentations'];
        hackingUpgrades.map(upgrade => {
            if (!memberHackingUpgrade.includes(upgrade) && ns.gang.getEquipmentCost(upgrade) < ns.getServerMoneyAvailable('home')) {
                ns.gang.purchaseEquipment(memberName, upgrade);
            }
        });
        hackingAugmentations.map(augmentation => {
            if (!memberHackingAugmentations.includes(augmentation) && ns.gang.getEquipmentCost(augmentation) < ns.getServerMoneyAvailable('home')) {
                ns.gang.purchaseEquipment(memberName, augmentation);
            }
        });
    });
}
export async function main(ns) {
    ns.disableLog('sleep');
    ns.disableLog('getServerMoneyAvailable');
    let counter = 0;
    while (true) {
        if (!ns.gang.inGang()) {
            ns.print(`Not in gang. Waiting.`);
            await ns.sleep(1000 * 60);
            continue;
        }
        ns.gang.getMemberNames().map(memberName => displayMembersInformation(ns, memberName));
        recruitIfPossible(ns);
        ascendIfGainIsWorth(ns);
        reassignMembersAccordingToWantedLevelPenalty(ns);
        buyEquipment(ns);
        if (counter >= 25) {
            ns.gang.getMemberNames().map(memberName => assignMember(ns, memberName));
            counter = 0;
        }
        else if (counter >= 23) {
            ns.gang.getMemberNames().map(memberName => assignMember(ns, memberName, 'Ethical Hacking'));
        }
        counter++;
        await ns.sleep(1000 * 30);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFuYWdlLWdhbmcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zY3JpcHRzL21hbmFnZS1nYW5nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLFNBQVMseUJBQXlCLENBQUMsRUFBTSxFQUFFLFVBQWtCO0lBQzNELE1BQU0sVUFBVSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDNUQsTUFBTSxZQUFZLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3hDLE1BQU0sV0FBVyxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN2QyxFQUFFLENBQUMsS0FBSyxDQUFDLFdBQVcsVUFBVSxvQkFBb0IsWUFBWSxXQUFXLFdBQVcsRUFBRSxDQUFDLENBQUM7QUFDMUYsQ0FBQztBQUVELFNBQVMsWUFBWSxDQUFDLEVBQU0sRUFBRSxJQUFZLEVBQUUsT0FBZSxFQUFFO0lBQzNELE1BQU0sVUFBVSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdEQsTUFBTSxZQUFZLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3hDLE1BQU0sV0FBVyxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUV2Qzs7Ozs7Ozs7Ozs7Ozs7Ozs7TUFpQkU7SUFDRixJQUFJLElBQUksSUFBSSxFQUFFLEVBQUU7UUFDZCxJQUFJLFdBQVcsSUFBSSxJQUFJLEVBQUU7WUFDdkIsRUFBRSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQ25DO0tBQ0Y7U0FBTSxJQUFJLFlBQVksR0FBRyxHQUFHLEVBQUU7UUFDN0IsSUFBSSxXQUFXLElBQUksZ0JBQWdCLEVBQUU7WUFDbkMsRUFBRSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLGdCQUFnQixDQUFDLENBQUM7U0FDL0M7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QUFDLENBQUM7WUFDbEMsTUFBTSxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQztZQUMxQixTQUFTO1NBQ1Y7UUFFRCxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLHlCQUF5QixDQUFDLEVBQUUsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBRXRGLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3RCLG1CQUFtQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3hCLDRDQUE0QyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUVqQixJQUFJLE9BQU8sSUFBSSxFQUFFLEVBQUU7WUFDakIsRUFBRSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsRUFBRSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFDekUsT0FBTyxHQUFHLENBQUMsQ0FBQztTQUNiO2FBQU0sSUFBSSxPQUFPLElBQUksRUFBRSxFQUFFO1lBQ3hCLEVBQUUsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLEVBQUUsRUFBRSxVQUFVLEVBQUUsaUJBQWlCLENBQUMsQ0FBQyxDQUFDO1NBQzdGO1FBRUQsT0FBTyxFQUFFLENBQUM7UUFDVixNQUFNLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0tBQzNCO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5TIH0gZnJvbSBcIkBuc1wiO1xuXG5mdW5jdGlvbiBkaXNwbGF5TWVtYmVyc0luZm9ybWF0aW9uKG5zOiBOUywgbWVtYmVyTmFtZTogc3RyaW5nKTogdm9pZCB7XG4gIGNvbnN0IG1lbWJlckluZm8gPSBucy5nYW5nLmdldE1lbWJlckluZm9ybWF0aW9uKG1lbWJlck5hbWUpO1xuICBjb25zdCBoYWNraW5nTGV2ZWwgPSBtZW1iZXJJbmZvWydoYWNrJ107XG4gIGNvbnN0IGN1cnJlbnRUYXNrID0gbWVtYmVySW5mb1sndGFzayddO1xuICBucy5wcmludChgTWVtYmVyOiAke21lbWJlck5hbWV9XFx0aGFja2luZyBsZXZlbDogJHtoYWNraW5nTGV2ZWx9XFx0dGFzazogJHtjdXJyZW50VGFza31gKTtcbn1cblxuZnVuY3Rpb24gYXNzaWduTWVtYmVyKG5zOiBOUywgbmFtZTogc3RyaW5nLCB0YXNrOiBzdHJpbmcgPSAnJyk6IHZvaWQge1xuICBjb25zdCBtZW1iZXJJbmZvID0gbnMuZ2FuZy5nZXRNZW1iZXJJbmZvcm1hdGlvbihuYW1lKTtcbiAgY29uc3QgaGFja2luZ0xldmVsID0gbWVtYmVySW5mb1snaGFjayddO1xuICBjb25zdCBjdXJyZW50VGFzayA9IG1lbWJlckluZm9bJ3Rhc2snXTtcblxuICAvKlxuICBUYXNrIG5hbWVzOlxuICAgICAgLSBVbmFzc2lnbmVkXG4gICAgICAtIFJhbnNvbXdhcmVcbiAgICAgIC0gUGhpc2hpbmdcbiAgICAgIC0gSWRlbnRpdHkgVGhlZnRcbiAgICAgIC0gRERvUyBBdHRhY2tzXG4gICAgICAtIFBsYW50IFZpcnVzXG4gICAgICAtIEZyYXVkICYgQ291bnRlcmZlaXRpbmcsXG4gICAgICAtIE1vbmV5IExhdW5kZXJpbmdcbiAgICAgIC0gQ3liZXJ0ZXJyb3Jpc21cbiAgICAgIC0gRXRoaWNhbCBIYWNraW5nXG4gICAgICAtIFZpZ2lsYW50ZSBKdXN0aWNlXG4gICAgICAtIFRyYWluIENvbWJhdFxuICAgICAgLSBUcmFpbiBIYWNraW5nXG4gICAgICAtIFRyYWluIENoYXJpc21hXG4gICAgICAtIFRlcnJpdG9yeSBXYXJmYXJlXG4gICovXG4gIGlmICh0YXNrICE9ICcnKSB7XG4gICAgaWYgKGN1cnJlbnRUYXNrICE9IHRhc2spIHtcbiAgICAgIG5zLmdhbmcuc2V0TWVtYmVyVGFzayhuYW1lLCB0YXNrKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoaGFja2luZ0xldmVsIDwgMTIwKSB7XG4gICAgaWYgKGN1cnJlbnRUYXNrICE9ICdDeWJlcnRlcnJvcmlzbScpIHtcbiAgICAgIG5zLmdhbmcuc2V0TWVtYmVyVGFzayhuYW1lLCAnQ3liZXJ0ZXJyb3Jpc20nKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKGN1cnJlbnRUYXNrICE9ICdNb25leSBMYXVuZGVyaW5nJykge1xuICAgICAgbnMuZ2FuZy5zZXRNZW1iZXJUYXNrKG5hbWUsICdNb25leSBMYXVuZGVyaW5nJyk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlY3J1aXRJZlBvc3NpYmxlKG5zOiBOUyk6IHZvaWQge1xuICBpZiAoIW5zLmdhbmcuY2FuUmVjcnVpdE1lbWJlcigpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgZ2FuZ01lbWJlcnMgPSBucy5nYW5nLmdldE1lbWJlck5hbWVzKCk7XG4gIGNvbnN0IG5ld0dhbmdNZW1iZXJOYW1lID0gYGF1ZHJleS0ke2dhbmdNZW1iZXJzLmxlbmd0aCArIDF9YDtcbiAgbnMuZ2FuZy5yZWNydWl0TWVtYmVyKG5ld0dhbmdNZW1iZXJOYW1lKTtcbiAgYXNzaWduTWVtYmVyKG5zLCBuZXdHYW5nTWVtYmVyTmFtZSk7XG59XG5cbmZ1bmN0aW9uIHJlYXNzaWduTWVtYmVyc0FjY29yZGluZ1RvV2FudGVkTGV2ZWxQZW5hbHR5KG5zOiBOUyk6IHZvaWQge1xuICBjb25zdCBnYW5nSW5mb3JtYXRpb24gPSBucy5nYW5nLmdldEdhbmdJbmZvcm1hdGlvbigpO1xuICAvKlxuICBHYW5nIGluZm9ybWF0aW9uIHN0cnVjdHVyZTpcbiAge1xuICAgICAgXCJmYWN0aW9uXCI6XCJOaXRlU2VjXCIsXG4gICAgICBcImlzSGFja2luZ1wiOnRydWUsXG4gICAgICBcIm1vbmV5R2FpblJhdGVcIjoyMTMuMTg5NTk2NDIzMjMwNzcsXG4gICAgICBcInBvd2VyXCI6MSxcbiAgICAgIFwicmVzcGVjdFwiOjg0Ni42MzE3OTk5NjAyNDksXG4gICAgICBcInJlc3BlY3RHYWluUmF0ZVwiOjAsXG4gICAgICBcInRlcnJpdG9yeVwiOjAuMTQyODU3MTQyODU3MTQyOTMsXG4gICAgICBcInRlcnJpdG9yeUNsYXNoQ2hhbmNlXCI6MCxcbiAgICAgIFwidGVycml0b3J5V2FyZmFyZUVuZ2FnZWRcIjpmYWxzZSxcbiAgICAgIFwid2FudGVkTGV2ZWxcIjozMTAuMjQ3MzQxOTQzODQ5MSxcbiAgICAgIFwid2FudGVkTGV2ZWxHYWluUmF0ZVwiOi0wLjAyNTMwMjg1NzE0Mjg1NzE1OCxcbiAgICAgIFwid2FudGVkUGVuYWx0eVwiOjAuNzMxODIzODk1MjQ4NzE1OVxuICB9XG4gICovXG5cbiAgY29uc3Qgd2FudGVkTGV2ZWxQZW5hbHR5ID0gMS4wIC0gZ2FuZ0luZm9ybWF0aW9uWyd3YW50ZWRQZW5hbHR5J107XG4gIGNvbnN0IGdhbmdSZXNwZWN0ID0gZ2FuZ0luZm9ybWF0aW9uWydyZXNwZWN0J107XG4gIGlmICh3YW50ZWRMZXZlbFBlbmFsdHkgPiAwLjI1ICYmIGdhbmdSZXNwZWN0ID4gNTApIHtcbiAgICBucy5nYW5nLmdldE1lbWJlck5hbWVzKCkubWFwKG1lbWJlck5hbWUgPT4ge1xuICAgICAgYXNzaWduTWVtYmVyKG5zLCBtZW1iZXJOYW1lLCAnRXRoaWNhbCBIYWNraW5nJyk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgbnMuZ2FuZy5nZXRNZW1iZXJOYW1lcygpLm1hcChtZW1iZXJOYW1lID0+IHtcbiAgICAgIGFzc2lnbk1lbWJlcihucywgbWVtYmVyTmFtZSk7XG4gICAgfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gYXNjZW5kSWZHYWluSXNXb3J0aChuczogTlMpOiB2b2lkIHtcbiAgbnMuZ2FuZy5nZXRNZW1iZXJOYW1lcygpLm1hcChtZW1iZXJOYW1lID0+IHtcbiAgICBjb25zdCByZXN1bHRzID0gbnMuZ2FuZy5nZXRBc2NlbnNpb25SZXN1bHQobWVtYmVyTmFtZSk7XG5cbiAgICBpZiAocmVzdWx0cyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgaGFja2luZ011bHRXaXRoQXNjZW5zaW9uID0gcmVzdWx0c1snaGFjayddO1xuXG4gICAgaWYgKGhhY2tpbmdNdWx0V2l0aEFzY2Vuc2lvbiA+IDIuMCkge1xuICAgICAgbnMuZ2FuZy5hc2NlbmRNZW1iZXIobWVtYmVyTmFtZSk7XG4gICAgICBhc3NpZ25NZW1iZXIobnMsIG1lbWJlck5hbWUpO1xuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGJ1eUVxdWlwbWVudChuczogTlMpOiB2b2lkIHtcbiAgLypcbiAgICAgIFtcbiAgICAgICAgICBcIkJhc2ViYWxsIEJhdFwiLFxuICAgICAgICAgIFwiS2F0YW5hXCIsXG4gICAgICAgICAgXCJHbG9jayAxOENcIixcbiAgICAgICAgICBcIlA5MENcIixcbiAgICAgICAgICBcIlN0ZXlyIEFVR1wiLFxuICAgICAgICAgIFwiQUstNDdcIixcbiAgICAgICAgICBcIk0xNUExMCBBc3NhdWx0IFJpZmxlXCIsXG4gICAgICAgICAgXCJBV00gU25pcGVyIFJpZmxlXCIsXG4gICAgICAgICAgXCJCdWxsZXRwcm9vZiBWZXN0XCIsXG4gICAgICAgICAgXCJGdWxsIEJvZHkgQXJtb3JcIixcbiAgICAgICAgICBcIkxpcXVpZCBCb2R5IEFybW9yXCIsXG4gICAgICAgICAgXCJHcmFwaGVuZSBQbGF0aW5nIEFybW9yXCIsXG4gICAgICAgICAgXCJGb3JkIEZsZXggVjIwXCIsXG4gICAgICAgICAgXCJBVFgxMDcwIFN1cGVyYmlrZVwiLFxuICAgICAgICAgIFwiTWVyY2VkZXMtQmVueiBTOTAwMVwiLFxuICAgICAgICAgIFwiV2hpdGUgRmVycmFyaVwiLFxuICAgICAgICAgIFwiTlVLRSBSb290a2l0XCIsXG4gICAgICAgICAgXCJTb3Vsc3RlYWxlciBSb290a2l0XCIsXG4gICAgICAgICAgXCJEZW1vbiBSb290a2l0XCIsXG4gICAgICAgICAgXCJIbWFwIE5vZGVcIixcbiAgICAgICAgICBcIkphY2sgdGhlIFJpcHBlclwiLFxuICAgICAgICAgIFwiQmlvbmljIEFybXNcIixcbiAgICAgICAgICBcIkJpb25pYyBMZWdzXCIsXG4gICAgICAgICAgXCJCaW9uaWMgU3BpbmVcIixcbiAgICAgICAgICBcIkJyYWNoaUJsYWRlc1wiLFxuICAgICAgICAgIFwiTmFub2ZpYmVyIFdlYXZlXCIsXG4gICAgICAgICAgXCJTeW50aGV0aWMgSGVhcnRcIixcbiAgICAgICAgICBcIlN5bmZpYnJpbCBNdXNjbGVcIixcbiAgICAgICAgICBcIkJpdFdpcmVcIixcbiAgICAgICAgICBcIk5ldXJhbHN0aW11bGF0b3JcIixcbiAgICAgICAgICBcIkRhdGFKYWNrXCIsXG4gICAgICAgICAgXCJHcmFwaGVuZSBCb25lIExhY2luZ3NcIlxuICAgICAgICAgIF1cbiAgKi9cbiAgY29uc3QgaGFja2luZ1VwZ3JhZGVzID0gWydOVUtFIFJvb3RraXQnLCAnU291bHN0ZWFsZXIgUm9vdGtpdCcsICdEZW1vbiBSb290a2l0JywgJ0htYXAgTm9kZScsICdKYWNrIHRoZSBSaXBwZXInXTtcbiAgY29uc3QgaGFja2luZ0F1Z21lbnRhdGlvbnMgPSBbJ0JpdFdpcmUnLCAnTmV1cmFsc3RpbXVsYXRvcicsICdEYXRhSmFjayddO1xuXG4gIG5zLmdhbmcuZ2V0TWVtYmVyTmFtZXMoKS5tYXAobWVtYmVyTmFtZSA9PiB7XG4gICAgY29uc3QgbWVtYmVySW5mbyA9IG5zLmdhbmcuZ2V0TWVtYmVySW5mb3JtYXRpb24obWVtYmVyTmFtZSk7XG4gICAgY29uc3QgbWVtYmVySGFja2luZ1VwZ3JhZGUgPSBtZW1iZXJJbmZvWyd1cGdyYWRlcyddO1xuICAgIGNvbnN0IG1lbWJlckhhY2tpbmdBdWdtZW50YXRpb25zID0gbWVtYmVySW5mb1snYXVnbWVudGF0aW9ucyddO1xuXG4gICAgaGFja2luZ1VwZ3JhZGVzLm1hcCh1cGdyYWRlID0+IHtcbiAgICAgIGlmICghbWVtYmVySGFja2luZ1VwZ3JhZGUuaW5jbHVkZXModXBncmFkZSkgJiYgbnMuZ2FuZy5nZXRFcXVpcG1lbnRDb3N0KHVwZ3JhZGUpIDwgbnMuZ2V0U2VydmVyTW9uZXlBdmFpbGFibGUoJ2hvbWUnKSkge1xuICAgICAgICBucy5nYW5nLnB1cmNoYXNlRXF1aXBtZW50KG1lbWJlck5hbWUsIHVwZ3JhZGUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaGFja2luZ0F1Z21lbnRhdGlvbnMubWFwKGF1Z21lbnRhdGlvbiA9PiB7XG4gICAgICBpZiAoIW1lbWJlckhhY2tpbmdBdWdtZW50YXRpb25zLmluY2x1ZGVzKGF1Z21lbnRhdGlvbikgJiYgbnMuZ2FuZy5nZXRFcXVpcG1lbnRDb3N0KGF1Z21lbnRhdGlvbikgPCBucy5nZXRTZXJ2ZXJNb25leUF2YWlsYWJsZSgnaG9tZScpKSB7XG4gICAgICAgIG5zLmdhbmcucHVyY2hhc2VFcXVpcG1lbnQobWVtYmVyTmFtZSwgYXVnbWVudGF0aW9uKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtYWluKG5zOiBOUyk6IFByb21pc2U8dm9pZD4ge1xuICBucy5kaXNhYmxlTG9nKCdzbGVlcCcpO1xuICBucy5kaXNhYmxlTG9nKCdnZXRTZXJ2ZXJNb25leUF2YWlsYWJsZScpO1xuICBsZXQgY291bnRlciA9IDA7XG5cbiAgd2hpbGUgKHRydWUpIHtcbiAgICBpZiAoIW5zLmdhbmcuaW5HYW5nKCkpIHtcbiAgICAgIG5zLnByaW50KGBOb3QgaW4gZ2FuZy4gV2FpdGluZy5gKTtcbiAgICAgIGF3YWl0IG5zLnNsZWVwKDEwMDAgKiA2MCk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBucy5nYW5nLmdldE1lbWJlck5hbWVzKCkubWFwKG1lbWJlck5hbWUgPT4gZGlzcGxheU1lbWJlcnNJbmZvcm1hdGlvbihucywgbWVtYmVyTmFtZSkpO1xuXG4gICAgcmVjcnVpdElmUG9zc2libGUobnMpO1xuICAgIGFzY2VuZElmR2FpbklzV29ydGgobnMpO1xuICAgIHJlYXNzaWduTWVtYmVyc0FjY29yZGluZ1RvV2FudGVkTGV2ZWxQZW5hbHR5KG5zKTtcbiAgICBidXlFcXVpcG1lbnQobnMpO1xuXG4gICAgaWYgKGNvdW50ZXIgPj0gMjUpIHtcbiAgICAgIG5zLmdhbmcuZ2V0TWVtYmVyTmFtZXMoKS5tYXAobWVtYmVyTmFtZSA9PiBhc3NpZ25NZW1iZXIobnMsIG1lbWJlck5hbWUpKTtcbiAgICAgIGNvdW50ZXIgPSAwO1xuICAgIH0gZWxzZSBpZiAoY291bnRlciA+PSAyMykge1xuICAgICAgbnMuZ2FuZy5nZXRNZW1iZXJOYW1lcygpLm1hcChtZW1iZXJOYW1lID0+IGFzc2lnbk1lbWJlcihucywgbWVtYmVyTmFtZSwgJ0V0aGljYWwgSGFja2luZycpKTtcbiAgICB9XG5cbiAgICBjb3VudGVyKys7XG4gICAgYXdhaXQgbnMuc2xlZXAoMTAwMCAqIDMwKTtcbiAgfVxufVxuIl19